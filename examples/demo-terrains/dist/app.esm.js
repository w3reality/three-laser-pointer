/*! For license information please see app.esm.js.LICENSE.txt */
var NoPkgName;(()=>{"use strict";var e=(e,t,r)=>{r.d(t,{default:()=>U});const n=THREE,a=DatGuiDefaults;var o=r.n(a);const i=Threelet;var s=r.n(i);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}function g(e,t){return g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},g(e,t)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=v(e);if(t){var a=v(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return p(this,r)}}function p(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var S="1.2.3",x=function(e){d(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f(this,r);var o={color:16711680,maxPoints:256,infLength:9999},i=Object.assign({},o,a);return e=t.call(this,i.maxPoints,i.color),console.info("Laser ".concat(S," with THREE r").concat(n.REVISION)),e.version=S,e._src=new n.Vector3(0,0,0),e._raycaster=new n.Raycaster,e._infLen=i.infLength,e._meshes=[],e}return m(r,[{key:"setSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._src=t?e.clone().applyMatrix4(t.matrixWorld):e.clone()}},{key:"getSource",value:function(){return this._src.clone()}},{key:"_raycast",value:function(e,t,r){var n=this._raycaster.intersectObjects(e,t);if(r){for(var a=0;a<n.length;a++)if(n[a].face!==r)return n[a];return null}return n.length>0?n[0]:null}},{key:"raycast",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this._raycaster.set(e,t),this._raycast(r,a,n)}},{key:"raycastFromCamera",value:function(e,t,r,a,o,i){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=new n.Vector2(e/r*2-1,-t/a*2+1);return this._raycaster.setFromCamera(u,o),this._raycast(i,s,null)}},{key:"getMeshesHit",value:function(){return this._meshes}},{key:"point",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.updatePoints([this._src.x,this._src.y,this._src.z,e.x,e.y,e.z],!0),this._meshes.length=0,t&&this.material.color.setHex(t)}},{key:"pointWithRaytrace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16;if(this.point(e,n),!(a<1)){var o=this.getSource(),i=r.direct(o,e),s=this.raycast(o,i,t);if(s){var u=this.computeReflections(e,i,s,t,a);this.updatePoints([o.x,o.y,o.z,e.x,e.y,e.z].concat(c(u)),!0)}}}},{key:"_computeReflectionsRecursive",value:function(e,t,a,o,i){var s=[],u=this;return function e(t,a,c){var h=(new n.Matrix3).getNormalMatrix(c.object.matrixWorld),f=c.face.normal.clone().applyMatrix3(h).normalize(),l=r.reflect(a,f),m=u.raycast(t,l,o,c.face);if(m){var d=m.point;s.push(d.x,d.y,d.z),s.length/3<i&&e(d,l,m)}else{var g=t.clone().add(l.multiplyScalar(u._infLen));s.push(g.x,g.y,g.z)}}(e,t,a),s}},{key:"_computeReflections",value:function(e,t,a,o,i){var s=[];for(this._meshes=[a.object];;){var u=(new n.Matrix3).getNormalMatrix(a.object.matrixWorld),c=a.face.normal.clone().applyMatrix3(u).normalize(),h=r.reflect(t,c),f=this.raycast(e,h,o,a.face);if(f){var l=f.point;if(s.push(l.x,l.y,l.z),this._meshes.push(f.object),s.length/3<i){e=l,t=h,a=f;continue}break}var m=e.clone().add(h.multiplyScalar(this._infLen));s.push(m.x,m.y,m.z);break}return s}},{key:"computeReflections",value:function(e,t,r,n,a){return this._computeReflections(e,t,r,n,a)}}],[{key:"direct",value:function(e,t){return t.clone().sub(e).normalize()}},{key:"reflect",value:function(e,t){return e.clone().sub(t.clone().multiplyScalar(2*e.dot(t)))}}]),r}(function(e){d(r,e);var t=y(r);function r(e){var a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680;f(this,r);var i=new n.BufferGeometry;return i.setAttribute("position",new n.BufferAttribute(new Float32Array(3*e),3)),(a=t.call(this,i,new n.LineBasicMaterial({color:o})))._maxPoints=e,a._numPoints=0,a}return m(r,[{key:"setColor",value:function(e){this.material.color.setHex(e)}},{key:"getColor",value:function(){return this.material.color}},{key:"getPoints",value:function(){for(var e=this.geometry.attributes.position.array,t=[],r=0;r<this._numPoints;r++)t.push(new n.Vector3(e[3*r],e[3*r+1],e[3*r+2]));return t}},{key:"updatePoints",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||(e=x.flattenPoints(e));var r=this.geometry.attributes.position,n=r.count,a=e.length/3;a>n&&(a=n);for(var o=0;o<a;o++)r.array[3*o]=e[3*o],r.array[3*o+1]=e[3*o+1],r.array[3*o+2]=e[3*o+2];r.needsUpdate=!0,this.geometry.setDrawRange(0,a),this._frustumCullingWorkaround(),this._numPoints=a}},{key:"clearPoints",value:function(){this.updatePoints([],!0)}},{key:"updatePointsRandomWalk",value:function(e){this.updatePoints(r._getPointsRandomWalk(e),!0)}},{key:"_frustumCullingWorkaround",value:function(){this.geometry.computeBoundingSphere()}}],[{key:"flattenPoints",value:function(e){return e.map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}))}},{key:"_getPointsRandomWalk",value:function(e){for(var t=[],r=0,n=0,a=0,o=0;o<e;o++)t.push(r),t.push(n),t.push(a),r+=2*(Math.random()-.5),n+=2*(Math.random()-.5),a+=2*(Math.random()-.5);return t}}]),r}(n.Line));const M=x;function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}var b,T={Terrain:{}},z=function(){return T.REVISION>="125"},k=function(e,t){var r=e.attributes.position,n=r.array,a=r.count,o=new Array(a).fill().map((function(e,t){return new T.Vector3(n[3*t],n[3*t+1],n[3*t+2])}));t(o),o.forEach((function(e,t){n[3*t]=e.x,n[3*t+1]=e.y,n[3*t+2]=e.z}))};!function(e){var t=e.noise={};function r(e,t,r){this.x=e,this.y=t,this.z=r}r.prototype.dot2=function(e,t){return this.x*e+this.y*t},r.prototype.dot3=function(e,t,r){return this.x*e+this.y*t+this.z*r};var n=[new r(1,1,0),new r(-1,1,0),new r(1,-1,0),new r(-1,-1,0),new r(1,0,1),new r(-1,0,1),new r(1,0,-1),new r(-1,0,-1),new r(0,1,1),new r(0,-1,1),new r(0,1,-1),new r(0,-1,-1)],a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],o=new Array(512),i=new Array(512);t.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var r;r=1&t?a[t]^255&e:a[t]^e>>8&255,o[t]=o[t+256]=r,i[t]=i[t+256]=n[r%12]}},t.seed(Math.random());var s=.5*(Math.sqrt(3)-1),u=(3-Math.sqrt(3))/6;function c(e){return e*e*e*(e*(6*e-15)+10)}function h(e,t,r){return(1-r)*e+r*t}t.simplex=function(e,t){var r,n,a=(e+t)*s,c=Math.floor(e+a),h=Math.floor(t+a),f=(c+h)*u,l=e-c+f,m=t-h+f;l>m?(r=1,n=0):(r=0,n=1);var d=l-r+u,g=m-n+u,y=l-1+2*u,p=m-1+2*u,v=i[(c&=255)+o[h&=255]],S=i[c+r+o[h+n]],x=i[c+1+o[h+1]],M=.5-l*l-m*m,w=.5-d*d-g*g,b=.5-y*y-p*p;return 70*((M<0?0:(M*=M)*M*v.dot2(l,m))+(w<0?0:(w*=w)*w*S.dot2(d,g))+(b<0?0:(b*=b)*b*x.dot2(y,p)))},t.perlin=function(e,t){var r=Math.floor(e),n=Math.floor(t);e-=r,t-=n;var a=i[(r&=255)+o[n&=255]].dot2(e,t),s=i[r+o[n+1]].dot2(e,t-1),u=i[r+1+o[n]].dot2(e-1,t),f=i[r+1+o[n+1]].dot2(e-1,t-1),l=c(e);return h(h(a,u,l),h(s,f,l),c(t))}}(T.Terrain),T.Terrain=function(e){var t={after:null,easing:T.Terrain.Linear,heightmap:T.Terrain.DiamondSquare,material:null,maxHeight:100,minHeight:-100,optimization:T.Terrain.NONE,frequency:2.5,steps:1,stretch:!0,turbulent:!1,useBufferGeometry:!1,xSegments:63,xSize:1024,ySegments:63,ySize:1024,_mesh:null};for(var r in e=e||{},t)t.hasOwnProperty(r)&&(e[r]=void 0===e[r]?t[r]:e[r]);e.material=e.material||new T.MeshBasicMaterial({color:15623731});var n=new T.Object3D;n.rotation.x=-.5*Math.PI;var a=e._mesh;if(a&&"PlaneGeometry"===a.geometry.type&&a.geometry.parameters.widthSegments===e.xSegments&&a.geometry.parameters.heightSegments===e.ySegments){a.material=e.material,a.scale.x=e.xSize/a.geometry.parameters.width,a.scale.y=e.ySize/a.geometry.parameters.height;for(var o=0,i=a.geometry.vertices.length;o<i;o++)a.geometry.vertices[o].z=0}else a=new T.Mesh(new T.PlaneGeometry(e.xSize,e.ySize,e.xSegments,e.ySegments),e.material);return delete e._mesh,a.geometry,e.heightmap instanceof HTMLCanvasElement||e.heightmap instanceof Image?z()?k(a.geometry,(function(t){return T.Terrain.fromHeightmap(t,e)})):T.Terrain.fromHeightmap(a.geometry.vertices,e):"function"==typeof e.heightmap?z()?k(a.geometry,(function(t){return e.heightmap(t,e)})):e.heightmap(a.geometry.vertices,e):console.warn("An invalid value was passed for `options.heightmap`: "+e.heightmap),T.Terrain.Normalize(a,e),e.useBufferGeometry&&(z()||(a.geometry=(new T.BufferGeometry).fromGeometry(a.geometry))),n.add(a),n},T.Terrain.Normalize=function(e,t){if(z())k(e.geometry,(function(e){t.turbulent&&T.Terrain.Turbulence(e,t),t.steps>1&&(T.Terrain.Step(e,t.steps),T.Terrain.Smooth(e,t)),T.Terrain.Clamp(e,t),"function"==typeof t.after&&t.after(e,t)}));else{var r=e.geometry.vertices;t.turbulent&&T.Terrain.Turbulence(r,t),t.steps>1&&(T.Terrain.Step(r,t.steps),T.Terrain.Smooth(r,t)),T.Terrain.Clamp(r,t),"function"==typeof t.after&&t.after(r,t)}e.geometry.verticesNeedUpdate=!0,e.geometry.normalsNeedUpdate=!0,e.geometry.computeBoundingSphere(),e.geometry.computeVertexNormals()},T.Terrain.NONE=0,T.Terrain.GEOMIPMAP=1,T.Terrain.GEOCLIPMAP=2,T.Terrain.POLYGONREDUCTION=3,T.Terrain.toArray2D=function(e,t){var r,n,a=new Array(t.xSegments),o=t.xSegments+1,i=t.ySegments+1;for(r=0;r<o;r++)for(a[r]=new Float64Array(t.ySegments),n=0;n<i;n++)a[r][n]=e[n*o+r].z;return a},T.Terrain.fromArray2D=function(e,t){for(var r=0,n=t.length;r<n;r++)for(var a=0,o=t[r].length;a<o;a++)e[a*n+r].z=t[r][a]},T.Terrain.toArray1D=function(e){for(var t=new Float64Array(e.length),r=0,n=t.length;r<n;r++)t[r]=e[r].z;return t},T.Terrain.fromArray1D=function(e,t){for(var r=0,n=Math.min(e.length,t.length);r<n;r++)e[r].z=t[r]},T.Terrain.heightmapArray=function(e,t){var r,n=new Array((t.xSegments+1)*(t.ySegments+1)),a=n.length;for(r=0;r<a;r++)n[r]={z:0};for(t.minHeight=t.minHeight||0,t.maxHeight=void 0===t.maxHeight?1:t.maxHeight,t.stretch=t.stretch||!1,e(n,t),T.Terrain.Clamp(n,t),r=0;r<a;r++)n[r]=n[r].z;return n},T.Terrain.Linear=function(e){return e},T.Terrain.EaseIn=function(e){return e*e},T.Terrain.EaseOut=function(e){return-e*(e-2)},T.Terrain.EaseInOut=function(e){return e*e*(3-2*e)},T.Terrain.InEaseOut=function(e){var t=2*e-1;return.5*t*t*t+.5},T.Terrain.EaseInWeak=function(e){return Math.pow(e,1.55)},T.Terrain.EaseInStrong=function(e){return e*e*e*e*e*e*e},T.Terrain.fromHeightmap=function(e,t){var r=document.createElement("canvas"),n=r.getContext("2d"),a=t.ySegments+1,o=t.xSegments+1,i=t.maxHeight-t.minHeight;r.width=o,r.height=a,n.drawImage(t.heightmap,0,0,r.width,r.height);for(var s=n.getImageData(0,0,r.width,r.height).data,u=0;u<a;u++)for(var c=0;c<o;c++){var h=u*o+c,f=4*h;e[h].z=(s[f]+s[f+1]+s[f+2])/765*i+t.minHeight}},T.Terrain.toHeightmap=function(e,t){var r=void 0===t.maxHeight,n=void 0===t.minHeight,a=r?t.maxHeight:-1/0,o=n?t.minHeight:1/0;if(!r||!n){for(var i=a,s=o,u=0,c=e.length;u<c;u++)e[u].z>i&&(i=e[u].z),e[u].z<s&&(s=e[u].z);r||(a=i),n||(o=s)}var h=t.heightmap instanceof HTMLCanvasElement?t.heightmap:document.createElement("canvas"),f=h.getContext("2d"),l=t.ySegments+1,m=t.xSegments+1,d=t.maxHeight-t.minHeight;h.width=m,h.height=l;for(var g=f.createImageData(h.width,h.height),y=g.data,p=0;p<l;p++)for(var v=0;v<m;v++){var S=p*m+v,x=4*S;y[x]=y[x+1]=y[x+2]=Math.round((e[S].z-t.minHeight)/d*255),y[x+3]=255}return f.putImageData(g,0,0),h},T.Terrain.Clamp=function(e,t){var r,n=1/0,a=-1/0,o=e.length;for(t.easing=t.easing||T.Terrain.Linear,r=0;r<o;r++)e[r].z<n&&(n=e[r].z),e[r].z>a&&(a=e[r].z);var i=a-n,s="number"!=typeof t.maxHeight?a:t.maxHeight,u="number"!=typeof t.minHeight?n:t.minHeight,c=t.stretch?s:a<s?a:s,h=t.stretch?u:n>u?n:u,f=c-h;for(c<h&&(f=(c=s)-h),r=0;r<o;r++)e[r].z=t.easing((e[r].z-n)/i)*f+u},T.Terrain.Edges=function(e,t,r,n,a,o){var i,s,u,c,h,f=Math.floor(n/(t.xSize/t.xSegments))||1,l=Math.floor(n/(t.ySize/t.ySegments))||1,m=r?t.maxHeight:t.minHeight,d=r?Math.max:Math.min,g=t.xSegments+1,y=t.ySegments+1;for(a=a||T.Terrain.EaseInOut,"object"!==w(o)&&(o={top:!0,bottom:!0,left:!0,right:!0}),i=0;i<g;i++)for(s=0;s<l;s++)u=a(1-s/l),c=s*g+i,h=(t.ySegments-s)*g+i,o.top&&(e[c].z=d(e[c].z,(m-e[c].z)*u+e[c].z)),o.bottom&&(e[h].z=d(e[h].z,(m-e[h].z)*u+e[h].z));for(i=0;i<y;i++)for(s=0;s<f;s++)u=a(1-s/f),c=i*g+s,h=(t.ySegments-i)*g+(t.xSegments-s),o.left&&(e[c].z=d(e[c].z,(m-e[c].z)*u+e[c].z)),o.right&&(e[h].z=d(e[h].z,(m-e[h].z)*u+e[h].z));T.Terrain.Clamp(e,{maxHeight:t.maxHeight,minHeight:t.minHeight,stretch:!0})},T.Terrain.RadialEdges=function(e,t,r,n,a){var o,i,s,u,c,h=r?t.maxHeight:t.minHeight,f=r?Math.max:Math.min,l=t.xSegments+1,m=.5*l,d=.5*(t.ySegments+1),g=t.xSize/t.xSegments,y=t.ySize/t.ySegments,p=.5*Math.min(t.xSize,t.ySize)-n;for(o=0;o<l;o++)for(i=0;i<d;i++)u=i*l+o,(c=Math.min(p,Math.sqrt((m-o)*g*(m-o)*g+(d-i)*y*(d-i)*y)-n))<0||(s=a(c/p),e[u].z=f(e[u].z,(h-e[u].z)*s+e[u].z),e[u=(t.ySegments-i)*l+o].z=f(e[u].z,(h-e[u].z)*s+e[u].z))},T.Terrain.Smooth=function(e,t,r){for(var n=new Float64Array(e.length),a=0,o=t.xSegments+1,i=t.ySegments+1;a<o;a++)for(var s=0;s<i;s++){for(var u=0,c=0,h=-1;h<=1;h++)for(var f=-1;f<=1;f++){var l=(s+h)*o+a+f;void 0!==e[l]&&a+f>=0&&s+h>=0&&a+f<o&&s+h<i&&(u+=e[l].z,c++)}n[s*o+a]=u/c}for(var m=1/(1+(r=r||0)),d=0,g=e.length;d<g;d++)e[d].z=(n[d]+e[d].z*r)*m},T.Terrain.SmoothMedian=function(e,t){for(var r=new Float64Array(e.length),n=[],a=[],o=function(e,t){return n[e]-n[t]},i=0,s=t.xSegments+1,u=t.ySegments+1;i<s;i++)for(var c=0;c<u;c++){n.length=0,a.length=0;for(var h=-1;h<=1;h++)for(var f=-1;f<=1;f++){var l=(c+h)*s+i+f;void 0!==e[l]&&i+f>=0&&c+h>=0&&i+f<s&&c+h<u&&(n.push(e[l].z),a.push(l))}a.sort(o);var m,d=Math.floor(.5*a.length);m=a.length%2==1?e[a[d]].z:.5*(e[a[d-1]].z+e[a[d]].z),r[c*s+i]=m}for(var g=0,y=e.length;g<y;g++)e[g].z=r[g]},T.Terrain.SmoothConservative=function(e,t,r){for(var n=new Float64Array(e.length),a=0,o=t.xSegments+1,i=t.ySegments+1;a<o;a++)for(var s=0;s<i;s++){for(var u=-1/0,c=1/0,h=-1;h<=1;h++)for(var f=-1;f<=1;f++){var l=(s+h)*o+a+f;void 0!==e[l]&&h&&f&&a+f>=0&&s+h>=0&&a+f<o&&s+h<i&&(e[l].z<c&&(c=e[l].z),e[l].z>u&&(u=e[l].z))}var m=s*o+a;if("number"==typeof r){var d=.5*(u-c),g=c+d;u=g+d*r,c=g-d*r}n[m]=e[m].z>u?u:e[m].z<c?c:e[m].z}for(var y=0,p=e.length;y<p;y++)e[y].z=n[y]},T.Terrain.Step=function(e,t){var r=0,n=0,a=e.length,o=Math.floor(a/t),i=new Array(a),s=new Array(t);for(void 0===t&&(t=Math.floor(Math.pow(.5*a,.25))),r=0;r<a;r++)i[r]=e[r].z;for(i.sort((function(e,t){return e-t})),r=0;r<t;r++){var u=i.slice(r*o,(r+1)*o),c=0,h=u.length;for(n=0;n<h;n++)c+=u[n];s[r]={min:u[0],max:u[u.length-1],avg:c/h}}for(r=0;r<a;r++){var f=e[r].z;for(n=0;n<t;n++)if(f>=s[n].min&&f<=s[n].max){e[r].z=s[n].avg;break}}},T.Terrain.Turbulence=function(e,t){for(var r=t.maxHeight-t.minHeight,n=0,a=e.length;n<a;n++)e[n].z=t.minHeight+Math.abs(2*(e[n].z-t.minHeight)-r)},T.Terrain.MultiPass=function(e,t,r){var n={};for(var a in t)t.hasOwnProperty(a)&&(n[a]=t[a]);for(var o=t.maxHeight-t.minHeight,i=0,s=r.length;i<s;i++){var u=.5*(o-o*(void 0===r[i].amplitude?1:r[i].amplitude));n.maxHeight=t.maxHeight-u,n.minHeight=t.minHeight+u,n.frequency=void 0===r[i].frequency?t.frequency:r[i].frequency,r[i].method(e,n)}},T.Terrain.Curve=function(e,t,r){for(var n=.5*(t.maxHeight-t.minHeight),a=t.frequency/(Math.min(t.xSegments,t.ySegments)+1),o=0,i=t.xSegments+1,s=t.ySegments+1;o<i;o++)for(var u=0;u<s;u++)e[u*i+o].z+=r(o*a,u*a)*n},T.Terrain.Cosine=function(e,t){for(var r=.5*(t.maxHeight-t.minHeight),n=t.frequency*Math.PI/(Math.min(t.xSegments,t.ySegments)+1),a=Math.random()*Math.PI*2,o=0,i=t.xSegments+1;o<i;o++)for(var s=0,u=t.ySegments+1;s<u;s++)e[s*i+o].z+=r*(Math.cos(o*n+a)+Math.cos(s*n+a))},T.Terrain.CosineLayers=function(e,t){T.Terrain.MultiPass(e,t,[{method:T.Terrain.Cosine,frequency:2.5},{method:T.Terrain.Cosine,amplitude:.1,frequency:12},{method:T.Terrain.Cosine,amplitude:.05,frequency:15},{method:T.Terrain.Cosine,amplitude:.025,frequency:20}])},T.Terrain.DiamondSquare=function(e,t){var r,n,a=T.Math.nextPowerOfTwo(Math.max(t.xSegments,t.ySegments)+1),o=a+1,i=[],s=t.maxHeight-t.minHeight,u=t.xSegments+1,c=t.ySegments+1;for(r=0;r<=a;r++)i[r]=new Float64Array(a+1);for(var h=a;h>=2;h/=2){var f,l,m,d,g=Math.round(.5*h),y=Math.round(h);for(s/=2,f=0;f<a;f+=y)for(l=0;l<a;l+=y)d=Math.random()*s*2-s,m=i[f][l]+i[f+y][l]+i[f][l+y]+i[f+y][l+y],m*=.25,i[f+g][l+g]=m+d;for(f=0;f<a;f+=g)for(l=(f+g)%h;l<a;l+=h)d=Math.random()*s*2-s,m=i[(f-g+o)%o][l]+i[(f+g)%o][l]+i[f][(l+g)%o]+i[f][(l-g+o)%o],m*=.25,m+=d,i[f][l]=m,0===f&&(i[a][l]=m),0===l&&(i[f][a]=m)}for(r=0;r<u;r++)for(n=0;n<c;n++)e[n*u+r].z+=i[r][n]},T.Terrain.Fault=function(e,t){for(var r=Math.sqrt(t.xSegments*t.xSegments+t.ySegments*t.ySegments),n=r*t.frequency,a=.5*(t.maxHeight-t.minHeight)/n,o=Math.min(t.xSize/t.xSegments,t.ySize/t.ySegments)*t.frequency,i=0;i<n;i++)for(var s=Math.random(),u=Math.sin(s*Math.PI*2),c=Math.cos(s*Math.PI*2),h=Math.random()*r-.5*r,f=0,l=t.xSegments+1;f<l;f++)for(var m=0,d=t.ySegments+1;m<d;m++){var g=u*f+c*m-h;g>o?e[m*l+f].z+=a:g<-o?e[m*l+f].z-=a:e[m*l+f].z+=Math.cos(g/o*Math.PI*2)*a}},T.Terrain.Hill=function(e,t,r,n){var a=2*t.frequency,o=a*a*10,i=t.maxHeight-t.minHeight,s=i/(a*a),u=i/a,c=Math.min(t.xSize,t.ySize),h=c/(a*a),f=c/a;r=r||T.Terrain.Influences.Hill;for(var l={x:0,y:0},m=0;m<o;m++){var d=Math.random()*(f-h)+h,g=Math.random()*(u-s)+s;t.xSize,t.ySize;l.x=Math.random(),l.y=Math.random(),"function"==typeof n&&n(l),T.Terrain.Influence(e,t,r,l.x,l.y,d,g,T.AdditiveBlending,T.Terrain.EaseInStrong)}},T.Terrain.HillIsland=(b=function(e){var t=Math.random()*Math.PI*2;e.x=.5+Math.cos(t)*e.x*.4,e.y=.5+Math.sin(t)*e.y*.4},function(e,t,r){T.Terrain.Hill(e,t,r,b)}),function(){function e(t,r,n,a,o){for(var i=n*a+r,s=0;s<3;s++){switch(Math.floor(8*Math.random())){case 0:r++;break;case 1:r--;break;case 2:n++;break;case 3:n--;break;case 4:r++,n++;break;case 5:r++,n--;break;case 6:r--,n++;break;case 7:r--,n--}var u=n*a+r;if(void 0!==t[u]){if(t[u].z<t[i].z)return void e(t,r,n,a,o)}else if(Math.random()<.2)return void(t[i].z+=o)}t[i].z+=o}T.Terrain.Particles=function(t,r){for(var n=Math.sqrt(r.xSegments*r.xSegments+r.ySegments*r.ySegments)*r.frequency*300,a=r.xSegments+1,o=(r.maxHeight-r.minHeight)/n*1e3,i=Math.floor(Math.random()*r.xSegments),s=Math.floor(Math.random()*r.ySegments),u=.2*Math.random()-.1,c=.2*Math.random()-.1,h=0;h<n;h++){e(t,i,s,a,o);var f=Math.random()*Math.PI*2;h%1e3==0&&(u=.2*Math.random()-.1,c=.2*Math.random()-.1),h%100==0&&(i=Math.floor(r.xSegments*(.5+u)+Math.cos(f)*Math.random()*r.xSegments*(.5-Math.abs(u))),s=Math.floor(r.ySegments*(.5+c)+Math.sin(f)*Math.random()*r.ySegments*(.5-Math.abs(c))))}}}(),T.Terrain.Perlin=function(e,t){noise.seed(Math.random());for(var r=.5*(t.maxHeight-t.minHeight),n=(Math.min(t.xSegments,t.ySegments)+1)/t.frequency,a=0,o=t.xSegments+1;a<o;a++)for(var i=0,s=t.ySegments+1;i<s;i++)e[i*o+a].z+=noise.perlin(a/n,i/n)*r},T.Terrain.PerlinDiamond=function(e,t){T.Terrain.MultiPass(e,t,[{method:T.Terrain.Perlin},{method:T.Terrain.DiamondSquare,amplitude:.75},{method:function(e,t){return T.Terrain.SmoothMedian(e,t)}}])},T.Terrain.PerlinLayers=function(e,t){T.Terrain.MultiPass(e,t,[{method:T.Terrain.Perlin,frequency:1.25},{method:T.Terrain.Perlin,amplitude:.05,frequency:2.5},{method:T.Terrain.Perlin,amplitude:.35,frequency:5},{method:T.Terrain.Perlin,amplitude:.15,frequency:10}])},T.Terrain.Simplex=function(e,t){noise.seed(Math.random());for(var r=.5*(t.maxHeight-t.minHeight),n=2*(Math.min(t.xSegments,t.ySegments)+1)/t.frequency,a=0,o=t.xSegments+1;a<o;a++)for(var i=0,s=t.ySegments+1;i<s;i++)e[i*o+a].z+=noise.simplex(a/n,i/n)*r},T.Terrain.SimplexLayers=function(e,t){T.Terrain.MultiPass(e,t,[{method:T.Terrain.Simplex,frequency:1.25},{method:T.Terrain.Simplex,amplitude:.5,frequency:2.5},{method:T.Terrain.Simplex,amplitude:.25,frequency:5},{method:T.Terrain.Simplex,amplitude:.125,frequency:10},{method:T.Terrain.Simplex,amplitude:.0625,frequency:20}])},function(){function e(e,t,r,n,a,o){if(!(r>n)){var i=0,s=0,u=n,c=n,h=Math.floor(n/r),f=-h,l=-h;for(i=0;i<=u;i+=h){for(s=0;s<=c;s+=h){var m=s*u+i;if(o[m]=Math.random()*a,!(f<0&&l<0)){for(var d=o[m],g=o[s*u+(i-h)]||d,y=o[(s-h)*u+i]||d,p=o[(s-h)*u+(i-h)]||d,v=f;v<i;v++)for(var S=l;S<s;S++)if(v!==f||S!==l){var x=S*u+v;if(!(x<0)){var M=(v-f)/h,w=(S-l)/h,b=M*y+(1-M)*p,T=M*d+(1-M)*g;o[x]=w*T+(1-w)*b}}l=s}}f=i,l=-h}for(i=0,u=t.xSegments+1;i<u;i++)for(s=0,c=t.ySegments+1;s<c;s++){var z=s*n+i;e[s*u+i].z+=o[z]}}}T.Terrain.Value=function(t,r){for(var n=T.Math.nextPowerOfTwo(Math.max(r.xSegments,r.ySegments)+1),a=new Float64Array((n+1)*(n+1)),o=r.maxHeight-r.minHeight,i=2;i<7;i++)e(t,r,Math.pow(2,i),n,o*Math.pow(2,2.4-1.2*i),a);T.Terrain.Clamp(t,{maxHeight:r.maxHeight,minHeight:r.minHeight,stretch:!0})}}(),T.Terrain.Weierstrass=function(e,t){for(var r=.5*(t.maxHeight-t.minHeight),n=Math.random()<.5?1:-1,a=Math.random()<.5?1:-1,o=.5+1*Math.random(),i=.5+1*Math.random(),s=.025+.1*Math.random(),u=2*Math.random()-1,c=.5+1*Math.random(),h=.5+1*Math.random(),f=.025+.1*Math.random(),l=2*Math.random()-1,m=0,d=t.xSegments+1;m<d;m++)for(var g=0,y=t.ySegments+1;g<y;g++){for(var p=0,v=0;v<20;v++){var S=Math.pow(1+o,-v)*Math.sin(Math.pow(1+i,v)*(m+.25*Math.cos(g)+u*g)*s),x=Math.pow(1+c,-v)*Math.sin(Math.pow(1+h,v)*(g+.25*Math.cos(m)+l*m)*f);p-=Math.exp(n*S*S+a*x*x)}e[g*d+m].z+=p*r}T.Terrain.Clamp(e,t)},T.Terrain.generateBlendedMaterial=function(e){function t(e){return e===(0|e)?e+".0":e+""}for(var r=T.UniformsUtils.merge([T.ShaderLib.lambert.uniforms]),n="",a="",o=e[0].texture.repeat,i=e[0].texture.offset,s=0,u=e.length;s<u;s++)if(e[s].texture.wrapS=e[s].wrapT=T.RepeatWrapping,e[s].texture.needsUpdate=!0,r["texture_"+s]={type:"t",value:e[s].texture},n+="uniform sampler2D texture_"+s+";\n",0!==s){var c=e[s].levels,h=e[s].glsl,f=void 0!==c,l=e[s].texture.repeat,m=e[s].texture.offset;if(f){c[1]-c[0]<1&&(c[0]-=1),c[3]-c[2]<1&&(c[3]+=1);for(var d=0;d<c.length;d++)c[d]=t(c[d])}var g=f?"1.0 - smoothstep("+c[0]+", "+c[1]+", vPosition.z) + smoothstep("+c[2]+", "+c[3]+", vPosition.z)":h;a+="        color = mix( texture2D( texture_"+s+", MyvUv * vec2( "+t(l.x)+", "+t(l.y)+" ) + vec2( "+t(m.x)+", "+t(m.y)+" ) ), color, max(min("+g+", 1.0), 0.0));\n"}var y={fog:!0,lights:!0,uniforms:r,vertexShader:T.ShaderLib.lambert.vertexShader.replace("void main() {","varying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal; void main() {\nMyvUv = uv;\nvPosition = position;\nmyNormal = normal;"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","    varying vec3 vLightBack;","#endif",T.ShaderChunk.common,T.ShaderChunk.packing,T.ShaderChunk.dithering_pars_fragment,T.ShaderChunk.color_pars_fragment,T.ShaderChunk.uv_pars_fragment,T.ShaderChunk.uv2_pars_fragment,T.ShaderChunk.map_pars_fragment,T.ShaderChunk.alphamap_pars_fragment,T.ShaderChunk.aomap_pars_fragment,T.ShaderChunk.lightmap_pars_fragment,T.ShaderChunk.emissivemap_pars_fragment,T.ShaderChunk.envmap_pars_fragment,T.ShaderChunk.bsdfs,T.ShaderChunk.lights_pars_begin,T.ShaderChunk.lights_pars_maps,T.ShaderChunk.fog_pars_fragment,T.ShaderChunk.shadowmap_pars_fragment,T.ShaderChunk.shadowmask_pars_fragment,T.ShaderChunk.specularmap_pars_fragment,T.ShaderChunk.logdepthbuf_pars_fragment,T.ShaderChunk.clipping_planes_pars_fragment,n,"varying vec2 MyvUv;","varying vec3 vPosition;","varying vec3 myNormal;","void main() {",T.ShaderChunk.clipping_planes_fragment,"ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","vec3 totalEmissiveRadiance = emissive;","float slope = acos(max(min(dot(myNormal, vec3(0.0, 0.0, 1.0)), 1.0), -1.0));","    vec4 diffuseColor = vec4( diffuse, opacity );","    vec4 color = texture2D( texture_0, MyvUv * vec2( "+t(o.x)+", "+t(o.y)+" ) + vec2( "+t(i.x)+", "+t(i.y)+" ) ); // base",a,"    diffuseColor = color;",T.ShaderChunk.logdepthbuf_fragment,T.ShaderChunk.map_fragment,T.ShaderChunk.color_fragment,T.ShaderChunk.alphamap_fragment,T.ShaderChunk.alphatest_fragment,T.ShaderChunk.specularmap_fragment,T.ShaderChunk.emissivemap_fragment,"   reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );",T.ShaderChunk.lightmap_fragment,"    reflectedLight.directDiffuse = diffuseColor.rgb;",T.ShaderChunk.aomap_fragment,"   vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;",T.ShaderChunk.normal_flip,T.ShaderChunk.envmap_fragment,"   gl_FragColor = vec4( outgoingLight, diffuseColor.a );",T.ShaderChunk.tonemapping_fragment,T.ShaderChunk.encodings_fragment,T.ShaderChunk.fog_fragment,T.ShaderChunk.premultiplied_alpha_fragment,T.ShaderChunk.dithering_fragment,"}"].join("\n")};return new T.ShaderMaterial(y)},T.Terrain.ScatterMeshes=function(e,t){if(t.mesh){t.scene||(t.scene=new T.Object3D);var r={spread:.025,smoothSpread:0,sizeVariance:.1,randomness:Math.random,maxSlope:.6283185307179586,maxTilt:1/0,w:0,h:0};for(var n in r)r.hasOwnProperty(n)&&(t[n]=void 0===t[n]?r[n]:t[n]);var a,o,i,s,u="number"==typeof t.spread,c=1/t.smoothSpread,h=2*t.sizeVariance,f=e.vertices,l=[],m=t.mesh.up.clone().applyAxisAngle(new T.Vector3(1,0,0),.5*Math.PI);u&&(o="number"==typeof(a=t.randomness())?Math.random:function(e){return a[e]});for(var d=0,g=2*t.w;d<g;d++)for(var y=0,p=t.h;y<p;y++)if(z()){if(Math.random()<.01){var v=t.mesh.clone(),S=Math.random(),x=e.attributes.position,M=x.array,w=x.count,b=Math.floor(w*S*.9);v.position.x=M[3*b],v.position.y=M[3*b+1],v.position.z=M[3*b+2],v.rotation.x+=.5*Math.PI,v.rotateY(2*S*Math.PI),l.push(v)}}else{var k=y*g+d,_=e.faces[k],C=!1;if(u){var P=o(k);P<t.spread?C=!0:P<t.spread+t.smoothSpread&&(C=T.Terrain.EaseInOut((P-t.spread)*c)*t.spread>Math.random())}else C=t.spread(f[_.a],k,_,d,y);if(C){if(_.normal.angleTo(m)>t.maxSlope)continue;var H=t.mesh.clone();if(H.position.copy(f[_.a]).add(f[_.b]).add(f[_.c]).divideScalar(3),t.maxTilt>0){var O=H.position.clone().add(_.normal);H.lookAt(O);var I=_.normal.angleTo(m);if(I>t.maxTilt){var R=t.maxTilt/I;H.rotation.x*=R,H.rotation.y*=R,H.rotation.z*=R}}if(H.rotation.x+=.5*Math.PI,H.rotateY(2*Math.random()*Math.PI),t.sizeVariance){var E=Math.random()*h-t.sizeVariance;H.scale.x=H.scale.z=1+E,H.scale.y+=E}l.push(H)}}if(!z()&&t.mesh.geometry instanceof T.Geometry){var L=new T.Geometry;for(i=0,s=l.length;i<s;i++){var j=l[i];j.updateMatrix(),L.merge(j.geometry,j.matrix)}t.scene.add(new T.Mesh(L,t.mesh.material))}else for(i=0,s=l.length;i<s;i++)t.scene.add(l[i]);return t.scene}console.error("options.mesh is required for THREE.Terrain.ScatterMeshes but was not passed")},T.Terrain.ScatterHelper=function(e,t,r,n){r=r||1,n=n||.25,t.frequency=t.frequency||2.5;var a={};for(var o in t)t.hasOwnProperty(o)&&(a[o]=t[o]);a.xSegments*=2,a.stretch=!0,a.maxHeight=1,a.minHeight=0;for(var i=T.Terrain.heightmapArray(e,a),s=0,u=i.length;s<u;s++)(s%r||Math.random()>n)&&(i[s]=1);return function(){return i}},T.Terrain.Influences={Mesa:function(e){return 1.25*Math.min(.8,Math.exp(-e*e))},Hole:function(e){return-T.Terrain.Influences.Mesa(e)},Hill:function(e){return e<0?(e+1)*(e+1)*(3-2*(e+1)):1-e*e*(3-2*e)},Valley:function(e){return-T.Terrain.Influences.Hill(e)},Dome:function(e){return-(e+1)*(e-1)},Flat:function(e){return 0},Volcano:function(e){return.94-.32*(Math.abs(2*e)+Math.cos(2*Math.PI*Math.abs(e)+.4))}},T.Terrain.Influence=function(e,t,r,n,a,o,i,s,u){r=r||T.Terrain.Influences.Hill,n=void 0===n?.5:n,a=void 0===a?.5:a,o=void 0===o?64:o,i=void 0===i?64:i,s=void 0===s?T.NormalBlending:s,u=u||T.Terrain.EaseIn;for(var c=t.xSegments+1,h=c*n,f=(t.ySegments+1)*a,l=t.xSize/t.xSegments,m=t.ySize/t.ySegments,d=o/l,g=o/m,y=1/o,p=Math.ceil(h-d),v=Math.floor(h+d),S=Math.ceil(f-g),x=Math.floor(f+g),M=p;M<v;M++)for(var w=S;w<x;w++){var b=w*c+M,z=(M-h)*l,k=(w-f)*m,_=Math.sqrt(z*z+k*k),C=_*y,P=z*y,H=k*y,O=r(C,P,H)*i*(1-u(C,P,H));_>o||void 0===e[b]||(s===T.AdditiveBlending?e[b].z+=O:s===T.SubtractiveBlending?e[b].z-=O:s===T.MultiplyBlending?e[b].z*=O:s===T.NoBlending?e[b].z=O:s===T.NormalBlending?e[b].z=u(C,P,H)*e[b].z+O:"function"==typeof s&&(e[b].z=s(e[b].z,O,C,P,H)))}};function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var P=function(e){return Object.assign(T,e).Terrain}(n),H=function(){return n.REVISION>="125"};console.warn("@@ __ge125():",H());var O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_(this,e);var r={xSize:1,ySize:1,maxHeight:.1,minHeight:-.1,xS:63,yS:63},n=Object.assign({},r,t);this.xSize=n.xSize,this.ySize=n.ySize,this.maxHeight=n.maxHeight,this.minHeight=n.minHeight,this.xS=n.xS,this.yS=n.yS}var t,r,a;return t=e,r=[{key:"getTerrainScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.DiamondSquare;return P({easing:P.Linear,frequency:2.5,heightmap:t,material:e,steps:1,useBufferGeometry:!1,xSize:this.xSize,ySize:this.ySize,maxHeight:this.maxHeight,minHeight:this.minHeight,xSegments:this.xS,ySegments:this.yS})}},{key:"getScatterMeshesScene",value:function(t){var r,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.001,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02;return r=H()?new n.Mesh(new n.CylinderGeometry(10*o,10*o,60*o,5),new n.MeshBasicMaterial({color:13421568})):e.buildTree(o),a||H()||(r.geometry=(new n.BufferGeometry).fromGeometry(r.geometry)),{scene:P.ScatterMeshes(t,{mesh:r,w:this.xS,h:this.yS,spread:i,randomness:Math.random}),material:r.material}}}],a=[{key:"loadHeightmapImage",value:function(e,t){var r=new Image;r.onload=function(){t(r)},r.src=e}},{key:"getBlendedMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,r=new n.TextureLoader;r.load("./sand1.jpg",(function(a){a.wrapS=a.wrapT=n.RepeatWrapping,r.load("./grass1.jpg",(function(n){r.load("./stone1.jpg",(function(o){r.load("./snow1.jpg",(function(r){var i=P.generateBlendedMaterial([{texture:a},{texture:n,levels:[-80*t,-35*t,20*t,50*t]},{texture:o,levels:[20*t,50*t,60*t,85*t]},{texture:r,glsl:"1.0 - smoothstep(".concat(65*t," + smoothstep(-256.0, 256.0, vPosition.x) * ").concat(10*t,", ").concat(80*t,", vPosition.z)")},{texture:o,glsl:"slope > 0.7853981633974483 ? 0.2 : 1.0 - smoothstep(0.47123889803846897, 0.7853981633974483, slope) + 0.2"}]);e(i)}))}))}))}))}},{key:"buildTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=[new n.MeshLambertMaterial({color:4007959}),new n.MeshLambertMaterial({color:2968606})],r=new n.Mesh(new n.CylinderGeometry(2*e,2*e,12*e,6*e,1*e,!0));r.position.y=6*e;var a=new n.Mesh(new n.CylinderGeometry(0*e,10*e,14*e,8*e));a.position.y=18*e;var o=new n.Mesh(new n.CylinderGeometry(0*e,9*e,13*e,8*e));o.position.y=25*e;var i=new n.Mesh(new n.CylinderGeometry(0*e,8*e,12*e,8*e));i.position.y=32*e;var s=new n.Geometry;r.updateMatrix(),a.updateMatrix(),o.updateMatrix(),i.updateMatrix(),s.merge(r.geometry,r.matrix),s.merge(a.geometry,a.matrix),s.merge(o.geometry,o.matrix),s.merge(i.geometry,i.matrix);for(var u=r.geometry.faces.length,c=0,h=s.faces.length;c<h;c++)s.faces[c].materialIndex=c<u?0:1;var f=new n.Mesh(s,t);return f.scale.x=f.scale.z=5,f.scale.y=1.25,f}},{key:"getSkyDome",value:function(e){(new n.TextureLoader).load("./sky1.jpg",(function(t){t.minFilter=n.LinearFilter;var r=new n.Mesh(new n.SphereGeometry(256,16,16,0,2*Math.PI,0,.5*Math.PI),new n.MeshBasicMaterial({map:t,side:n.BackSide,fog:!1}));r.position.y=-.99,e(r)}))}},{key:"getWater",value:function(){var e=new n.Mesh(new n.PlaneBufferGeometry(17408,17408,16,16),new n.MeshLambertMaterial({color:27552,transparent:!0,opacity:.6}));return e.position.y=-.99,e.rotation.x=-.5*Math.PI,e}},{key:"getSunLight",value:function(){var e=new n.DirectionalLight(15252912,1.5);return e.position.set(2950,2625,-160),e}},{key:"getSkyLight",value:function(){var e=new n.DirectionalLight(12839679,.75);return e.position.set(-1,-.5,-1),e}}],r&&C(t.prototype,r),a&&C(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();const I=O;function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],i=!0,s=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(s)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return L(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function q(e,t,r){return t&&A(e.prototype,t),r&&A(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function D(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}function B(e,t){return B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},B(e,t)}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=F(e);if(t){var a=F(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return G(this,r)}}function G(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}var V=function(e){D(r,e);var t=N(r);function r(){return j(this,r),t.apply(this,arguments)}return q(r,[{key:"initGui",value:function(e,t,r){var n=this;e.add(r,"laserMode",["Raytrace","Measure","None"]).name("Laser Mode").onChange((function(e){t.laserMode=e})),e.add(r,"vis",["Textured","Wireframe","None"]).name("Terrain").onChange((function(e){t.onChangeVis(e),t.vis=e})),e.add(r,"evRender").name("Passive Render").onChange((function(e){t.onChangeEvRender(e),t.evRender=e})),e.add(r,"thunder").name("Thunder").onChange((function(e){t.onThunder()})),e.add(r,"reset").name("Reset").onChange((function(e){n.applyDefaults(),t.onChangeVis(r.vis),t.onChangeEvRender(r.evRender),t.onMark(null,!0),t.onThunder(!0),Object.assign(t,r)})),e.add(r,"sourceCode").name("Source Code").onChange((function(e){window.location.href="https://github.com/w3reality/three-laser-pointer/tree/master/examples/demo-terrains"}))}}]),r}(o()),W=function(e){D(r,e);var t=N(r);function r(){return j(this,r),t.apply(this,arguments)}return q(r,[{key:"onCreate",value:function(e){var t=this,a=this.canvas,o=a.width,i=a.height,s=r.init(this.scene,this.render,o,i),u=s.config,c=s.pick,h=s.markToggle,f=s.markCancel;u.onChangeVis=function(e){t.scene.traverse((function(t){if(!(!t instanceof n.Mesh)&&t.name&&"terrain"===t.name)switch(e){case"Textured":t.material.wireframe=!1,t.material.needsUpdate=!0,t.visible=!0;break;case"Wireframe":t.material.wireframe=!0,t.material.needsUpdate=!0,t.visible=!0;break;case"None":t.visible=!1}})),t.render()},u.onChangeEvRender=function(e){e?t.updateLoop(0):t.updateLoop(60)},new V(u).setDefaults({vis:u.vis,laserMode:u.laserMode,evRender:u.evRender,thunder:function(){},reset:function(){},sourceCode:function(){}});var l=this.camera;l.position.set(0,0,.5);var m=document.getElementById("msg"),d=function(e){return r._updateRaytraceStats(m,e)},g=function(e){return r._updateMeasureStats(m,e)};this.on("pointer-move",(function(e,t){return c(e,t,l,d)})),this.on("pointer-click",(function(e,t){return h(e,t,l,g)})),this.on("pointer-click-right",(function(e,t){return f(g)}))}}],[{key:"_updateRaytraceStats",value:function(e,t){var r=t.getPoints(),n=r.shift();r.pop();this.clear(e),r.length>0&&(this.appendText(e,"laser source: ".concat(this.toCoords(n))),this.appendText(e,"# reflections: ".concat(r.length)),this.appendText(e,"reflection points: ".concat(this.toCoordsArray(r))))}},{key:"_updateMeasureStats",value:function(e,t){if(this.clear(e),1===t.length)this.appendText(e,"points: ".concat(this.toCoords(t[0])," -> "));else if(2===t.length){var r=E(t,2),n=r[0],a=r[1];this.appendText(e,"points: ".concat(this.toCoords(n)," -> ").concat(this.toCoords(a))),this.appendText(e,"length: ".concat(n.distanceTo(a).toFixed(3)))}}},{key:"toCoords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return"(".concat(e.x.toFixed(t),", ").concat(e.y.toFixed(t),", ").concat(e.z.toFixed(t),")")}},{key:"toCoordsArray",value:function(e){var t=this;return e.map((function(e){return t.toCoords(e)})).join(", ")}},{key:"appendText",value:function(e,t){var r=document.createElement("div");r.appendChild(document.createTextNode(t)),e.appendChild(r)}},{key:"clear",value:function(e){for(;e.firstChild;)e.firstChild.remove()}},{key:"init",value:function(e,t,r,a){var o=new I({xSize:1,ySize:1,maxHeight:.1,minHeight:-.1}),i=[];I.getBlendedMaterial((function(r){I.loadHeightmapImage("./heightmapMods.png",(function(n){var a=o.getTerrainScene(r,n),s=a.children[0];s.name="terrain",i.push(s);var u=o.getScatterMeshesScene(s.geometry,!1).scene;a.add(u),i=i.concat(u.children),e.add(a),t()}))})),I.getSkyDome((function(r){e.add(r),t()})),e.add(I.getWater()),e.add(I.getSunLight()),e.add(I.getSkyLight());var s=new n.MeshBasicMaterial({color:5596842,wireframe:!0}),u=new M({color:16711680});e.add(u);var c=new M({maxPoints:2});e.add(c);var h,f=[],l={vis:"Textured",laserMode:"Raytrace",evRender:!0},m=new n.Group;e.add(m),l.onMark=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r?m.clear():m.add(e),t()};var d=new n.Group;return e.add(d),l.onThunder=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e)d.clear();else{var r=new M({color:16776960,maxPoints:32});r.updatePointsRandomWalk(32),d.add(r)}t()},{config:l,pick:function(e,o,m,d){if("None"!==l.laserMode){var g=u.raycastFromCamera(e,o,r,a,m,i);if(null!==g){var y=g.point,p=new n.Vector3(.003,-.004,.002);if("Raytrace"===l.laserMode)u.setSource(p,m),u.pointWithRaytrace(y,i,65535,16),u.getMeshesHit().forEach((function(e){"terrain"!==e.name&&(e.material=s)}));else"Measure"===l.laserMode&&(u.setSource(p,m),u.point(y,16777215),1===f.length?(c.setSource(f[0]),c.point(y,h),c.visible=!0):c.visible=!1)}else u.clearPoints();l.evRender&&t(),"Raytrace"===l.laserMode&&d(u)}else u.clearPoints()},markToggle:function(e,n,o,s){if("Measure"===l.laserMode){var c=u.raycastFromCamera(e,n,r,a,o,i);if(null!==c){var m=c.point;if(1===f.length){f.push(m);var d=new M({maxPoints:2,color:h});d.updatePoints(f),l.onMark(d)}else f=[m],h=Math.floor(16777215*Math.random())}l.evRender&&t(),s(f)}},markCancel:function(e){e(f=[]),c.visible=!1,l.evRender&&t()}}}}]),r}(s());const U=function(e,t){var r=new W({canvas:document.getElementById("canvas")});r.setup("mod-stats",t,{panelType:1}),r.setup("mod-controls",e),r.render()}},t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},r={};e(0,r,t),NoPkgName=r.default})();export default NoPkgName;