/*! For license information please see app.esm.js.LICENSE.txt */
var NoPkgName;NoPkgName=(()=>{"use strict";var e={486:(e,t,r)=>{r.d(t,{default:()=>G});const n=THREE,a=DatGuiDefaults;var i=r.n(a);const o=Stats;var s=r.n(o);const u=$;var c=r.n(u);function f(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),e}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=x(e);if(t){var a=x(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return S(this,r)}}function S(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var M="1.2.3-dev.2",w=function(e){v(r,e);var t=p(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(this,r);var i={color:16711680,maxPoints:256,infLength:9999},o=Object.assign({},i,a);return e=t.call(this,o.maxPoints,o.color),console.info("Laser ".concat(M," with THREE r").concat(n.REVISION)),e.version=M,e._src=new n.Vector3(0,0,0),e._raycaster=new n.Raycaster,e._infLen=o.infLength,e._meshes=[],e}return g(r,[{key:"setSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._src=t?e.clone().applyMatrix4(t.matrixWorld):e.clone()}},{key:"getSource",value:function(){return this._src.clone()}},{key:"_raycast",value:function(e,t,r){var n=this._raycaster.intersectObjects(e,t);if(r){for(var a=0;a<n.length;a++)if(n[a].face!==r)return n[a];return null}return n.length>0?n[0]:null}},{key:"raycast",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this._raycaster.set(e,t),this._raycast(r,a,n)}},{key:"raycastFromCamera",value:function(e,t,r,a,i,o){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=new n.Vector2(e/r*2-1,-t/a*2+1);return this._raycaster.setFromCamera(u,i),this._raycast(o,s,null)}},{key:"getMeshesHit",value:function(){return this._meshes}},{key:"point",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.updatePoints([this._src.x,this._src.y,this._src.z,e.x,e.y,e.z],!0),this._meshes.length=0,t&&this.material.color.setHex(t)}},{key:"pointWithRaytrace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16;if(this.point(e,n),!(a<1)){var i=this.getSource(),o=r.direct(i,e),s=this.raycast(i,o,t);if(s){var u=this.computeReflections(e,o,s,t,a);this.updatePoints([i.x,i.y,i.z,e.x,e.y,e.z].concat(f(u)),!0)}}}},{key:"_computeReflectionsRecursive",value:function(e,t,a,i,o){var s=[],u=this;return function e(t,a,c){var f=(new n.Matrix3).getNormalMatrix(c.object.matrixWorld),h=c.face.normal.clone().applyMatrix3(f).normalize(),m=r.reflect(a,h),l=u.raycast(t,m,i,c.face);if(l){var d=l.point;s.push(d.x,d.y,d.z),s.length/3<o&&e(d,m,l)}else{var g=t.clone().add(m.multiplyScalar(u._infLen));s.push(g.x,g.y,g.z)}}(e,t,a),s}},{key:"_computeReflections",value:function(e,t,a,i,o){var s=[];for(this._meshes=[a.object];;){var u=(new n.Matrix3).getNormalMatrix(a.object.matrixWorld),c=a.face.normal.clone().applyMatrix3(u).normalize(),f=r.reflect(t,c),h=this.raycast(e,f,i,a.face);if(h){var m=h.point;if(s.push(m.x,m.y,m.z),this._meshes.push(h.object),s.length/3<o){e=m,t=f,a=h;continue}break}var l=e.clone().add(f.multiplyScalar(this._infLen));s.push(l.x,l.y,l.z);break}return s}},{key:"computeReflections",value:function(e,t,r,n,a){return this._computeReflections(e,t,r,n,a)}}],[{key:"direct",value:function(e,t){return t.clone().sub(e).normalize()}},{key:"reflect",value:function(e,t){return e.clone().sub(t.clone().multiplyScalar(2*e.dot(t)))}}]),r}(function(e){v(r,e);var t=p(r);function r(e){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680;l(this,r);var o=new n.BufferGeometry,s=new Float32Array(3*e);o.setAttribute("position",new n.BufferAttribute(s,3));var u=new n.LineBasicMaterial({color:i});return(a=t.call(this,o,u))._maxPoints=e,a._numPoints=0,a}return g(r,[{key:"_frustumCullingWorkaround",value:function(){this.geometry.computeBoundingSphere()}},{key:"setColor",value:function(e){this.material.color.setHex(e)}},{key:"getColor",value:function(){return this.material.color}},{key:"getPoints",value:function(){for(var e=this.geometry.attributes.position.array,t=[],r=0;r<this._numPoints;r++)t.push(new n.Vector3(e[3*r],e[3*r+1],e[3*r+2]));return t}},{key:"updatePoints",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||(e=w.flattenPoints(e));var r=this.geometry.attributes.position,n=r.count,a=e.length/3;a>n&&(a=n);for(var i=0;i<a;i++)r.array[3*i]=e[3*i],r.array[3*i+1]=e[3*i+1],r.array[3*i+2]=e[3*i+2];r.needsUpdate=!0,this.geometry.setDrawRange(0,a),this._frustumCullingWorkaround(),this._numPoints=a}},{key:"clearPoints",value:function(){this.updatePoints([],!0)}},{key:"updatePointsRandomWalk",value:function(e){this.updatePoints(r._getPointsRandomWalk(e),!0)}}],[{key:"_getPointsRandomWalk",value:function(e){for(var t=[],r=0,n=0,a=0,i=0;i<e;i++)t.push(r),t.push(n),t.push(a),r+=2*(Math.random()-.5),n+=2*(Math.random()-.5),a+=2*(Math.random()-.5);return t}},{key:"flattenPoints",value:function(e){return e.map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}))}}]),r}(n.Line));const b=w;function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var T,_={Terrain:{}},k=function(){return _.REVISION>="125"},H=function(e,t){var r=e.attributes.position,n=r.array,a=r.count,i=new Array(a).fill().map((function(e,t){return new _.Vector3(n[3*t],n[3*t+1],n[3*t+2])}));t(i),i.forEach((function(e,t){n[3*t]=e.x,n[3*t+1]=e.y,n[3*t+2]=e.z}))};!function(e){var t=e.noise={};function r(e,t,r){this.x=e,this.y=t,this.z=r}r.prototype.dot2=function(e,t){return this.x*e+this.y*t},r.prototype.dot3=function(e,t,r){return this.x*e+this.y*t+this.z*r};var n=[new r(1,1,0),new r(-1,1,0),new r(1,-1,0),new r(-1,-1,0),new r(1,0,1),new r(-1,0,1),new r(1,0,-1),new r(-1,0,-1),new r(0,1,1),new r(0,-1,1),new r(0,1,-1),new r(0,-1,-1)],a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],i=new Array(512),o=new Array(512);t.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var r;r=1&t?a[t]^255&e:a[t]^e>>8&255,i[t]=i[t+256]=r,o[t]=o[t+256]=n[r%12]}},t.seed(Math.random());var s=.5*(Math.sqrt(3)-1),u=(3-Math.sqrt(3))/6;function c(e){return e*e*e*(e*(6*e-15)+10)}function f(e,t,r){return(1-r)*e+r*t}t.simplex=function(e,t){var r,n,a=(e+t)*s,c=Math.floor(e+a),f=Math.floor(t+a),h=(c+f)*u,m=e-c+h,l=t-f+h;m>l?(r=1,n=0):(r=0,n=1);var d=m-r+u,g=l-n+u,v=m-1+2*u,y=l-1+2*u,p=o[(c&=255)+i[f&=255]],S=o[c+r+i[f+n]],x=o[c+1+i[f+1]],M=.5-m*m-l*l,w=.5-d*d-g*g,b=.5-v*v-y*y;return 70*((M<0?0:(M*=M)*M*p.dot2(m,l))+(w<0?0:(w*=w)*w*S.dot2(d,g))+(b<0?0:(b*=b)*b*x.dot2(v,y)))},t.perlin=function(e,t){var r=Math.floor(e),n=Math.floor(t);e-=r,t-=n;var a=o[(r&=255)+i[n&=255]].dot2(e,t),s=o[r+i[n+1]].dot2(e,t-1),u=o[r+1+i[n]].dot2(e-1,t),h=o[r+1+i[n+1]].dot2(e-1,t-1),m=c(e);return f(f(a,u,m),f(s,h,m),c(t))}}(_.Terrain),_.Terrain=function(e){var t={after:null,easing:_.Terrain.Linear,heightmap:_.Terrain.DiamondSquare,material:null,maxHeight:100,minHeight:-100,optimization:_.Terrain.NONE,frequency:2.5,steps:1,stretch:!0,turbulent:!1,useBufferGeometry:!1,xSegments:63,xSize:1024,ySegments:63,ySize:1024,_mesh:null};for(var r in e=e||{},t)t.hasOwnProperty(r)&&(e[r]=void 0===e[r]?t[r]:e[r]);e.material=e.material||new _.MeshBasicMaterial({color:15623731});var n=new _.Object3D;n.rotation.x=-.5*Math.PI;var a=e._mesh;if(a&&"PlaneGeometry"===a.geometry.type&&a.geometry.parameters.widthSegments===e.xSegments&&a.geometry.parameters.heightSegments===e.ySegments){a.material=e.material,a.scale.x=e.xSize/a.geometry.parameters.width,a.scale.y=e.ySize/a.geometry.parameters.height;for(var i=0,o=a.geometry.vertices.length;i<o;i++)a.geometry.vertices[i].z=0}else a=new _.Mesh(new _.PlaneGeometry(e.xSize,e.ySize,e.xSegments,e.ySegments),e.material);return delete e._mesh,a.geometry,e.heightmap instanceof HTMLCanvasElement||e.heightmap instanceof Image?k()?H(a.geometry,(function(t){return _.Terrain.fromHeightmap(t,e)})):_.Terrain.fromHeightmap(a.geometry.vertices,e):"function"==typeof e.heightmap?k()?H(a.geometry,(function(t){return e.heightmap(t,e)})):e.heightmap(a.geometry.vertices,e):console.warn("An invalid value was passed for `options.heightmap`: "+e.heightmap),_.Terrain.Normalize(a,e),e.useBufferGeometry&&(k()||(a.geometry=(new _.BufferGeometry).fromGeometry(a.geometry))),n.add(a),n},_.Terrain.Normalize=function(e,t){if(k())H(e.geometry,(function(e){t.turbulent&&_.Terrain.Turbulence(e,t),t.steps>1&&(_.Terrain.Step(e,t.steps),_.Terrain.Smooth(e,t)),_.Terrain.Clamp(e,t),"function"==typeof t.after&&t.after(e,t)}));else{var r=e.geometry.vertices;t.turbulent&&_.Terrain.Turbulence(r,t),t.steps>1&&(_.Terrain.Step(r,t.steps),_.Terrain.Smooth(r,t)),_.Terrain.Clamp(r,t),"function"==typeof t.after&&t.after(r,t)}e.geometry.verticesNeedUpdate=!0,e.geometry.normalsNeedUpdate=!0,e.geometry.computeBoundingSphere(),e.geometry.computeFaceNormals(),e.geometry.computeVertexNormals()},_.Terrain.NONE=0,_.Terrain.GEOMIPMAP=1,_.Terrain.GEOCLIPMAP=2,_.Terrain.POLYGONREDUCTION=3,_.Terrain.toArray2D=function(e,t){var r,n,a=new Array(t.xSegments),i=t.xSegments+1,o=t.ySegments+1;for(r=0;r<i;r++)for(a[r]=new Float64Array(t.ySegments),n=0;n<o;n++)a[r][n]=e[n*i+r].z;return a},_.Terrain.fromArray2D=function(e,t){for(var r=0,n=t.length;r<n;r++)for(var a=0,i=t[r].length;a<i;a++)e[a*n+r].z=t[r][a]},_.Terrain.toArray1D=function(e){for(var t=new Float64Array(e.length),r=0,n=t.length;r<n;r++)t[r]=e[r].z;return t},_.Terrain.fromArray1D=function(e,t){for(var r=0,n=Math.min(e.length,t.length);r<n;r++)e[r].z=t[r]},_.Terrain.heightmapArray=function(e,t){var r,n=new Array((t.xSegments+1)*(t.ySegments+1)),a=n.length;for(r=0;r<a;r++)n[r]={z:0};for(t.minHeight=t.minHeight||0,t.maxHeight=void 0===t.maxHeight?1:t.maxHeight,t.stretch=t.stretch||!1,e(n,t),_.Terrain.Clamp(n,t),r=0;r<a;r++)n[r]=n[r].z;return n},_.Terrain.Linear=function(e){return e},_.Terrain.EaseIn=function(e){return e*e},_.Terrain.EaseOut=function(e){return-e*(e-2)},_.Terrain.EaseInOut=function(e){return e*e*(3-2*e)},_.Terrain.InEaseOut=function(e){var t=2*e-1;return.5*t*t*t+.5},_.Terrain.EaseInWeak=function(e){return Math.pow(e,1.55)},_.Terrain.EaseInStrong=function(e){return e*e*e*e*e*e*e},_.Terrain.fromHeightmap=function(e,t){var r=document.createElement("canvas"),n=r.getContext("2d"),a=t.ySegments+1,i=t.xSegments+1,o=t.maxHeight-t.minHeight;r.width=i,r.height=a,n.drawImage(t.heightmap,0,0,r.width,r.height);for(var s=n.getImageData(0,0,r.width,r.height).data,u=0;u<a;u++)for(var c=0;c<i;c++){var f=u*i+c,h=4*f;e[f].z=(s[h]+s[h+1]+s[h+2])/765*o+t.minHeight}},_.Terrain.toHeightmap=function(e,t){var r=void 0===t.maxHeight,n=void 0===t.minHeight,a=r?t.maxHeight:-1/0,i=n?t.minHeight:1/0;if(!r||!n){for(var o=a,s=i,u=0,c=e.length;u<c;u++)e[u].z>o&&(o=e[u].z),e[u].z<s&&(s=e[u].z);r||(a=o),n||(i=s)}var f=t.heightmap instanceof HTMLCanvasElement?t.heightmap:document.createElement("canvas"),h=f.getContext("2d"),m=t.ySegments+1,l=t.xSegments+1,d=t.maxHeight-t.minHeight;f.width=l,f.height=m;for(var g=h.createImageData(f.width,f.height),v=g.data,y=0;y<m;y++)for(var p=0;p<l;p++){var S=y*l+p,x=4*S;v[x]=v[x+1]=v[x+2]=Math.round((e[S].z-t.minHeight)/d*255),v[x+3]=255}return h.putImageData(g,0,0),f},_.Terrain.Clamp=function(e,t){var r,n=1/0,a=-1/0,i=e.length;for(t.easing=t.easing||_.Terrain.Linear,r=0;r<i;r++)e[r].z<n&&(n=e[r].z),e[r].z>a&&(a=e[r].z);var o=a-n,s="number"!=typeof t.maxHeight?a:t.maxHeight,u="number"!=typeof t.minHeight?n:t.minHeight,c=t.stretch?s:a<s?a:s,f=t.stretch?u:n>u?n:u,h=c-f;for(c<f&&(h=(c=s)-f),r=0;r<i;r++)e[r].z=t.easing((e[r].z-n)/o)*h+u},_.Terrain.Edges=function(e,t,r,n,a,i){var o,s,u,c,f,h=Math.floor(n/(t.xSize/t.xSegments))||1,m=Math.floor(n/(t.ySize/t.ySegments))||1,l=r?t.maxHeight:t.minHeight,d=r?Math.max:Math.min,g=t.xSegments+1,v=t.ySegments+1;for(a=a||_.Terrain.EaseInOut,"object"!==z(i)&&(i={top:!0,bottom:!0,left:!0,right:!0}),o=0;o<g;o++)for(s=0;s<m;s++)u=a(1-s/m),c=s*g+o,f=(t.ySegments-s)*g+o,i.top&&(e[c].z=d(e[c].z,(l-e[c].z)*u+e[c].z)),i.bottom&&(e[f].z=d(e[f].z,(l-e[f].z)*u+e[f].z));for(o=0;o<v;o++)for(s=0;s<h;s++)u=a(1-s/h),c=o*g+s,f=(t.ySegments-o)*g+(t.xSegments-s),i.left&&(e[c].z=d(e[c].z,(l-e[c].z)*u+e[c].z)),i.right&&(e[f].z=d(e[f].z,(l-e[f].z)*u+e[f].z));_.Terrain.Clamp(e,{maxHeight:t.maxHeight,minHeight:t.minHeight,stretch:!0})},_.Terrain.RadialEdges=function(e,t,r,n,a){var i,o,s,u,c,f=r?t.maxHeight:t.minHeight,h=r?Math.max:Math.min,m=t.xSegments+1,l=.5*m,d=.5*(t.ySegments+1),g=t.xSize/t.xSegments,v=t.ySize/t.ySegments,y=.5*Math.min(t.xSize,t.ySize)-n;for(i=0;i<m;i++)for(o=0;o<d;o++)u=o*m+i,(c=Math.min(y,Math.sqrt((l-i)*g*(l-i)*g+(d-o)*v*(d-o)*v)-n))<0||(s=a(c/y),e[u].z=h(e[u].z,(f-e[u].z)*s+e[u].z),e[u=(t.ySegments-o)*m+i].z=h(e[u].z,(f-e[u].z)*s+e[u].z))},_.Terrain.Smooth=function(e,t,r){for(var n=new Float64Array(e.length),a=0,i=t.xSegments+1,o=t.ySegments+1;a<i;a++)for(var s=0;s<o;s++){for(var u=0,c=0,f=-1;f<=1;f++)for(var h=-1;h<=1;h++){var m=(s+f)*i+a+h;void 0!==e[m]&&a+h>=0&&s+f>=0&&a+h<i&&s+f<o&&(u+=e[m].z,c++)}n[s*i+a]=u/c}for(var l=1/(1+(r=r||0)),d=0,g=e.length;d<g;d++)e[d].z=(n[d]+e[d].z*r)*l},_.Terrain.SmoothMedian=function(e,t){for(var r=new Float64Array(e.length),n=[],a=[],i=function(e,t){return n[e]-n[t]},o=0,s=t.xSegments+1,u=t.ySegments+1;o<s;o++)for(var c=0;c<u;c++){n.length=0,a.length=0;for(var f=-1;f<=1;f++)for(var h=-1;h<=1;h++){var m=(c+f)*s+o+h;void 0!==e[m]&&o+h>=0&&c+f>=0&&o+h<s&&c+f<u&&(n.push(e[m].z),a.push(m))}a.sort(i);var l,d=Math.floor(.5*a.length);l=a.length%2==1?e[a[d]].z:.5*(e[a[d-1]].z+e[a[d]].z),r[c*s+o]=l}for(var g=0,v=e.length;g<v;g++)e[g].z=r[g]},_.Terrain.SmoothConservative=function(e,t,r){for(var n=new Float64Array(e.length),a=0,i=t.xSegments+1,o=t.ySegments+1;a<i;a++)for(var s=0;s<o;s++){for(var u=-1/0,c=1/0,f=-1;f<=1;f++)for(var h=-1;h<=1;h++){var m=(s+f)*i+a+h;void 0!==e[m]&&f&&h&&a+h>=0&&s+f>=0&&a+h<i&&s+f<o&&(e[m].z<c&&(c=e[m].z),e[m].z>u&&(u=e[m].z))}var l=s*i+a;if("number"==typeof r){var d=.5*(u-c),g=c+d;u=g+d*r,c=g-d*r}n[l]=e[l].z>u?u:e[l].z<c?c:e[l].z}for(var v=0,y=e.length;v<y;v++)e[v].z=n[v]},_.Terrain.Step=function(e,t){var r=0,n=0,a=e.length,i=Math.floor(a/t),o=new Array(a),s=new Array(t);for(void 0===t&&(t=Math.floor(Math.pow(.5*a,.25))),r=0;r<a;r++)o[r]=e[r].z;for(o.sort((function(e,t){return e-t})),r=0;r<t;r++){var u=o.slice(r*i,(r+1)*i),c=0,f=u.length;for(n=0;n<f;n++)c+=u[n];s[r]={min:u[0],max:u[u.length-1],avg:c/f}}for(r=0;r<a;r++){var h=e[r].z;for(n=0;n<t;n++)if(h>=s[n].min&&h<=s[n].max){e[r].z=s[n].avg;break}}},_.Terrain.Turbulence=function(e,t){for(var r=t.maxHeight-t.minHeight,n=0,a=e.length;n<a;n++)e[n].z=t.minHeight+Math.abs(2*(e[n].z-t.minHeight)-r)},_.Terrain.MultiPass=function(e,t,r){var n={};for(var a in t)t.hasOwnProperty(a)&&(n[a]=t[a]);for(var i=t.maxHeight-t.minHeight,o=0,s=r.length;o<s;o++){var u=.5*(i-i*(void 0===r[o].amplitude?1:r[o].amplitude));n.maxHeight=t.maxHeight-u,n.minHeight=t.minHeight+u,n.frequency=void 0===r[o].frequency?t.frequency:r[o].frequency,r[o].method(e,n)}},_.Terrain.Curve=function(e,t,r){for(var n=.5*(t.maxHeight-t.minHeight),a=t.frequency/(Math.min(t.xSegments,t.ySegments)+1),i=0,o=t.xSegments+1,s=t.ySegments+1;i<o;i++)for(var u=0;u<s;u++)e[u*o+i].z+=r(i*a,u*a)*n},_.Terrain.Cosine=function(e,t){for(var r=.5*(t.maxHeight-t.minHeight),n=t.frequency*Math.PI/(Math.min(t.xSegments,t.ySegments)+1),a=Math.random()*Math.PI*2,i=0,o=t.xSegments+1;i<o;i++)for(var s=0,u=t.ySegments+1;s<u;s++)e[s*o+i].z+=r*(Math.cos(i*n+a)+Math.cos(s*n+a))},_.Terrain.CosineLayers=function(e,t){_.Terrain.MultiPass(e,t,[{method:_.Terrain.Cosine,frequency:2.5},{method:_.Terrain.Cosine,amplitude:.1,frequency:12},{method:_.Terrain.Cosine,amplitude:.05,frequency:15},{method:_.Terrain.Cosine,amplitude:.025,frequency:20}])},_.Terrain.DiamondSquare=function(e,t){var r,n,a=_.Math.nextPowerOfTwo(Math.max(t.xSegments,t.ySegments)+1),i=a+1,o=[],s=t.maxHeight-t.minHeight,u=t.xSegments+1,c=t.ySegments+1;for(r=0;r<=a;r++)o[r]=new Float64Array(a+1);for(var f=a;f>=2;f/=2){var h,m,l,d,g=Math.round(.5*f),v=Math.round(f);for(s/=2,h=0;h<a;h+=v)for(m=0;m<a;m+=v)d=Math.random()*s*2-s,l=o[h][m]+o[h+v][m]+o[h][m+v]+o[h+v][m+v],l*=.25,o[h+g][m+g]=l+d;for(h=0;h<a;h+=g)for(m=(h+g)%f;m<a;m+=f)d=Math.random()*s*2-s,l=o[(h-g+i)%i][m]+o[(h+g)%i][m]+o[h][(m+g)%i]+o[h][(m-g+i)%i],l*=.25,l+=d,o[h][m]=l,0===h&&(o[a][m]=l),0===m&&(o[h][a]=l)}for(r=0;r<u;r++)for(n=0;n<c;n++)e[n*u+r].z+=o[r][n]},_.Terrain.Fault=function(e,t){for(var r=Math.sqrt(t.xSegments*t.xSegments+t.ySegments*t.ySegments),n=r*t.frequency,a=.5*(t.maxHeight-t.minHeight)/n,i=Math.min(t.xSize/t.xSegments,t.ySize/t.ySegments)*t.frequency,o=0;o<n;o++)for(var s=Math.random(),u=Math.sin(s*Math.PI*2),c=Math.cos(s*Math.PI*2),f=Math.random()*r-.5*r,h=0,m=t.xSegments+1;h<m;h++)for(var l=0,d=t.ySegments+1;l<d;l++){var g=u*h+c*l-f;g>i?e[l*m+h].z+=a:g<-i?e[l*m+h].z-=a:e[l*m+h].z+=Math.cos(g/i*Math.PI*2)*a}},_.Terrain.Hill=function(e,t,r,n){var a=2*t.frequency,i=a*a*10,o=t.maxHeight-t.minHeight,s=o/(a*a),u=o/a,c=Math.min(t.xSize,t.ySize),f=c/(a*a),h=c/a;r=r||_.Terrain.Influences.Hill;for(var m={x:0,y:0},l=0;l<i;l++){var d=Math.random()*(h-f)+f,g=Math.random()*(u-s)+s;t.xSize,t.ySize;m.x=Math.random(),m.y=Math.random(),"function"==typeof n&&n(m),_.Terrain.Influence(e,t,r,m.x,m.y,d,g,_.AdditiveBlending,_.Terrain.EaseInStrong)}},_.Terrain.HillIsland=(T=function(e){var t=Math.random()*Math.PI*2;e.x=.5+Math.cos(t)*e.x*.4,e.y=.5+Math.sin(t)*e.y*.4},function(e,t,r){_.Terrain.Hill(e,t,r,T)}),function(){function e(t,r,n,a,i){for(var o=n*a+r,s=0;s<3;s++){switch(Math.floor(8*Math.random())){case 0:r++;break;case 1:r--;break;case 2:n++;break;case 3:n--;break;case 4:r++,n++;break;case 5:r++,n--;break;case 6:r--,n++;break;case 7:r--,n--}var u=n*a+r;if(void 0!==t[u]){if(t[u].z<t[o].z)return void e(t,r,n,a,i)}else if(Math.random()<.2)return void(t[o].z+=i)}t[o].z+=i}_.Terrain.Particles=function(t,r){for(var n=Math.sqrt(r.xSegments*r.xSegments+r.ySegments*r.ySegments)*r.frequency*300,a=r.xSegments+1,i=(r.maxHeight-r.minHeight)/n*1e3,o=Math.floor(Math.random()*r.xSegments),s=Math.floor(Math.random()*r.ySegments),u=.2*Math.random()-.1,c=.2*Math.random()-.1,f=0;f<n;f++){e(t,o,s,a,i);var h=Math.random()*Math.PI*2;f%1e3==0&&(u=.2*Math.random()-.1,c=.2*Math.random()-.1),f%100==0&&(o=Math.floor(r.xSegments*(.5+u)+Math.cos(h)*Math.random()*r.xSegments*(.5-Math.abs(u))),s=Math.floor(r.ySegments*(.5+c)+Math.sin(h)*Math.random()*r.ySegments*(.5-Math.abs(c))))}}}(),_.Terrain.Perlin=function(e,t){noise.seed(Math.random());for(var r=.5*(t.maxHeight-t.minHeight),n=(Math.min(t.xSegments,t.ySegments)+1)/t.frequency,a=0,i=t.xSegments+1;a<i;a++)for(var o=0,s=t.ySegments+1;o<s;o++)e[o*i+a].z+=noise.perlin(a/n,o/n)*r},_.Terrain.PerlinDiamond=function(e,t){_.Terrain.MultiPass(e,t,[{method:_.Terrain.Perlin},{method:_.Terrain.DiamondSquare,amplitude:.75},{method:function(e,t){return _.Terrain.SmoothMedian(e,t)}}])},_.Terrain.PerlinLayers=function(e,t){_.Terrain.MultiPass(e,t,[{method:_.Terrain.Perlin,frequency:1.25},{method:_.Terrain.Perlin,amplitude:.05,frequency:2.5},{method:_.Terrain.Perlin,amplitude:.35,frequency:5},{method:_.Terrain.Perlin,amplitude:.15,frequency:10}])},_.Terrain.Simplex=function(e,t){noise.seed(Math.random());for(var r=.5*(t.maxHeight-t.minHeight),n=2*(Math.min(t.xSegments,t.ySegments)+1)/t.frequency,a=0,i=t.xSegments+1;a<i;a++)for(var o=0,s=t.ySegments+1;o<s;o++)e[o*i+a].z+=noise.simplex(a/n,o/n)*r},_.Terrain.SimplexLayers=function(e,t){_.Terrain.MultiPass(e,t,[{method:_.Terrain.Simplex,frequency:1.25},{method:_.Terrain.Simplex,amplitude:.5,frequency:2.5},{method:_.Terrain.Simplex,amplitude:.25,frequency:5},{method:_.Terrain.Simplex,amplitude:.125,frequency:10},{method:_.Terrain.Simplex,amplitude:.0625,frequency:20}])},function(){function e(e,t,r,n,a,i){if(!(r>n)){var o=0,s=0,u=n,c=n,f=Math.floor(n/r),h=-f,m=-f;for(o=0;o<=u;o+=f){for(s=0;s<=c;s+=f){var l=s*u+o;if(i[l]=Math.random()*a,!(h<0&&m<0)){for(var d=i[l],g=i[s*u+(o-f)]||d,v=i[(s-f)*u+o]||d,y=i[(s-f)*u+(o-f)]||d,p=h;p<o;p++)for(var S=m;S<s;S++)if(p!==h||S!==m){var x=S*u+p;if(!(x<0)){var M=(p-h)/f,w=(S-m)/f,b=M*v+(1-M)*y,z=M*d+(1-M)*g;i[x]=w*z+(1-w)*b}}m=s}}h=o,m=-f}for(o=0,u=t.xSegments+1;o<u;o++)for(s=0,c=t.ySegments+1;s<c;s++){var T=s*n+o;e[s*u+o].z+=i[T]}}}_.Terrain.Value=function(t,r){for(var n=_.Math.nextPowerOfTwo(Math.max(r.xSegments,r.ySegments)+1),a=new Float64Array((n+1)*(n+1)),i=r.maxHeight-r.minHeight,o=2;o<7;o++)e(t,r,Math.pow(2,o),n,i*Math.pow(2,2.4-1.2*o),a);_.Terrain.Clamp(t,{maxHeight:r.maxHeight,minHeight:r.minHeight,stretch:!0})}}(),_.Terrain.Weierstrass=function(e,t){for(var r=.5*(t.maxHeight-t.minHeight),n=Math.random()<.5?1:-1,a=Math.random()<.5?1:-1,i=.5+1*Math.random(),o=.5+1*Math.random(),s=.025+.1*Math.random(),u=2*Math.random()-1,c=.5+1*Math.random(),f=.5+1*Math.random(),h=.025+.1*Math.random(),m=2*Math.random()-1,l=0,d=t.xSegments+1;l<d;l++)for(var g=0,v=t.ySegments+1;g<v;g++){for(var y=0,p=0;p<20;p++){var S=Math.pow(1+i,-p)*Math.sin(Math.pow(1+o,p)*(l+.25*Math.cos(g)+u*g)*s),x=Math.pow(1+c,-p)*Math.sin(Math.pow(1+f,p)*(g+.25*Math.cos(l)+m*l)*h);y-=Math.exp(n*S*S+a*x*x)}e[g*d+l].z+=y*r}_.Terrain.Clamp(e,t)},_.Terrain.generateBlendedMaterial=function(e){function t(e){return e===(0|e)?e+".0":e+""}for(var r=_.UniformsUtils.merge([_.ShaderLib.lambert.uniforms]),n="",a="",i=e[0].texture.repeat,o=e[0].texture.offset,s=0,u=e.length;s<u;s++)if(e[s].texture.wrapS=e[s].wrapT=_.RepeatWrapping,e[s].texture.needsUpdate=!0,r["texture_"+s]={type:"t",value:e[s].texture},n+="uniform sampler2D texture_"+s+";\n",0!==s){var c=e[s].levels,f=e[s].glsl,h=void 0!==c,m=e[s].texture.repeat,l=e[s].texture.offset;if(h){c[1]-c[0]<1&&(c[0]-=1),c[3]-c[2]<1&&(c[3]+=1);for(var d=0;d<c.length;d++)c[d]=t(c[d])}var g=h?"1.0 - smoothstep("+c[0]+", "+c[1]+", vPosition.z) + smoothstep("+c[2]+", "+c[3]+", vPosition.z)":f;a+="        color = mix( texture2D( texture_"+s+", MyvUv * vec2( "+t(m.x)+", "+t(m.y)+" ) + vec2( "+t(l.x)+", "+t(l.y)+" ) ), color, max(min("+g+", 1.0), 0.0));\n"}var v={fog:!0,lights:!0,uniforms:r,vertexShader:_.ShaderLib.lambert.vertexShader.replace("void main() {","varying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal; void main() {\nMyvUv = uv;\nvPosition = position;\nmyNormal = normal;"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","    varying vec3 vLightBack;","#endif",_.ShaderChunk.common,_.ShaderChunk.packing,_.ShaderChunk.dithering_pars_fragment,_.ShaderChunk.color_pars_fragment,_.ShaderChunk.uv_pars_fragment,_.ShaderChunk.uv2_pars_fragment,_.ShaderChunk.map_pars_fragment,_.ShaderChunk.alphamap_pars_fragment,_.ShaderChunk.aomap_pars_fragment,_.ShaderChunk.lightmap_pars_fragment,_.ShaderChunk.emissivemap_pars_fragment,_.ShaderChunk.envmap_pars_fragment,_.ShaderChunk.bsdfs,_.ShaderChunk.lights_pars_begin,_.ShaderChunk.lights_pars_maps,_.ShaderChunk.fog_pars_fragment,_.ShaderChunk.shadowmap_pars_fragment,_.ShaderChunk.shadowmask_pars_fragment,_.ShaderChunk.specularmap_pars_fragment,_.ShaderChunk.logdepthbuf_pars_fragment,_.ShaderChunk.clipping_planes_pars_fragment,n,"varying vec2 MyvUv;","varying vec3 vPosition;","varying vec3 myNormal;","void main() {",_.ShaderChunk.clipping_planes_fragment,"ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","vec3 totalEmissiveRadiance = emissive;","float slope = acos(max(min(dot(myNormal, vec3(0.0, 0.0, 1.0)), 1.0), -1.0));","    vec4 diffuseColor = vec4( diffuse, opacity );","    vec4 color = texture2D( texture_0, MyvUv * vec2( "+t(i.x)+", "+t(i.y)+" ) + vec2( "+t(o.x)+", "+t(o.y)+" ) ); // base",a,"    diffuseColor = color;",_.ShaderChunk.logdepthbuf_fragment,_.ShaderChunk.map_fragment,_.ShaderChunk.color_fragment,_.ShaderChunk.alphamap_fragment,_.ShaderChunk.alphatest_fragment,_.ShaderChunk.specularmap_fragment,_.ShaderChunk.emissivemap_fragment,"   reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );",_.ShaderChunk.lightmap_fragment,"    reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );","    #ifdef DOUBLE_SIDED","            reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;","    #else","            reflectedLight.directDiffuse = vLightFront;","    #endif","    reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();",_.ShaderChunk.aomap_fragment,"   vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;",_.ShaderChunk.normal_flip,_.ShaderChunk.envmap_fragment,"   gl_FragColor = vec4( outgoingLight, diffuseColor.a );",_.ShaderChunk.tonemapping_fragment,_.ShaderChunk.encodings_fragment,_.ShaderChunk.fog_fragment,_.ShaderChunk.premultiplied_alpha_fragment,_.ShaderChunk.dithering_fragment,"}"].join("\n")};return new _.ShaderMaterial(v)},_.Terrain.ScatterMeshes=function(e,t){if(t.mesh){t.scene||(t.scene=new _.Object3D);var r={spread:.025,smoothSpread:0,sizeVariance:.1,randomness:Math.random,maxSlope:.6283185307179586,maxTilt:1/0,w:0,h:0};for(var n in r)r.hasOwnProperty(n)&&(t[n]=void 0===t[n]?r[n]:t[n]);var a,i,o,s,u="number"==typeof t.spread,c=1/t.smoothSpread,f=2*t.sizeVariance,h=e.vertices,m=[],l=t.mesh.up.clone().applyAxisAngle(new _.Vector3(1,0,0),.5*Math.PI);u&&(i="number"==typeof(a=t.randomness())?Math.random:function(e){return a[e]});for(var d=0,g=2*t.w;d<g;d++)for(var v=0,y=t.h;v<y;v++)if(k()){if(Math.random()<.01){var p=t.mesh.clone(),S=Math.random(),x=e.attributes.position,M=x.array,w=x.count,b=Math.floor(w*S*.9);p.position.x=M[3*b],p.position.y=M[3*b+1],p.position.z=M[3*b+2],p.rotation.x+=.5*Math.PI,p.rotateY(2*S*Math.PI),m.push(p)}}else{var z=v*g+d,T=e.faces[z],H=!1;if(u){var P=i(z);P<t.spread?H=!0:P<t.spread+t.smoothSpread&&(H=_.Terrain.EaseInOut((P-t.spread)*c)*t.spread>Math.random())}else H=t.spread(h[T.a],z,T,d,v);if(H){if(T.normal.angleTo(l)>t.maxSlope)continue;var C=t.mesh.clone();if(C.position.copy(h[T.a]).add(h[T.b]).add(h[T.c]).divideScalar(3),t.maxTilt>0){var I=C.position.clone().add(T.normal);C.lookAt(I);var L=T.normal.angleTo(l);if(L>t.maxTilt){var O=t.maxTilt/L;C.rotation.x*=O,C.rotation.y*=O,C.rotation.z*=O}}if(C.rotation.x+=.5*Math.PI,C.rotateY(2*Math.random()*Math.PI),t.sizeVariance){var R=Math.random()*f-t.sizeVariance;C.scale.x=C.scale.z=1+R,C.scale.y+=R}m.push(C)}}if(!k()&&t.mesh.geometry instanceof _.Geometry){var E=new _.Geometry;for(o=0,s=m.length;o<s;o++){var D=m[o];D.updateMatrix(),E.merge(D.geometry,D.matrix)}t.scene.add(new _.Mesh(E,t.mesh.material))}else for(o=0,s=m.length;o<s;o++)t.scene.add(m[o]);return t.scene}console.error("options.mesh is required for THREE.Terrain.ScatterMeshes but was not passed")},_.Terrain.ScatterHelper=function(e,t,r,n){r=r||1,n=n||.25,t.frequency=t.frequency||2.5;var a={};for(var i in t)t.hasOwnProperty(i)&&(a[i]=t[i]);a.xSegments*=2,a.stretch=!0,a.maxHeight=1,a.minHeight=0;for(var o=_.Terrain.heightmapArray(e,a),s=0,u=o.length;s<u;s++)(s%r||Math.random()>n)&&(o[s]=1);return function(){return o}},_.Terrain.Influences={Mesa:function(e){return 1.25*Math.min(.8,Math.exp(-e*e))},Hole:function(e){return-_.Terrain.Influences.Mesa(e)},Hill:function(e){return e<0?(e+1)*(e+1)*(3-2*(e+1)):1-e*e*(3-2*e)},Valley:function(e){return-_.Terrain.Influences.Hill(e)},Dome:function(e){return-(e+1)*(e-1)},Flat:function(e){return 0},Volcano:function(e){return.94-.32*(Math.abs(2*e)+Math.cos(2*Math.PI*Math.abs(e)+.4))}},_.Terrain.Influence=function(e,t,r,n,a,i,o,s,u){r=r||_.Terrain.Influences.Hill,n=void 0===n?.5:n,a=void 0===a?.5:a,i=void 0===i?64:i,o=void 0===o?64:o,s=void 0===s?_.NormalBlending:s,u=u||_.Terrain.EaseIn;for(var c=t.xSegments+1,f=c*n,h=(t.ySegments+1)*a,m=t.xSize/t.xSegments,l=t.ySize/t.ySegments,d=i/m,g=i/l,v=1/i,y=Math.ceil(f-d),p=Math.floor(f+d),S=Math.ceil(h-g),x=Math.floor(h+g),M=y;M<p;M++)for(var w=S;w<x;w++){var b=w*c+M,z=(M-f)*m,T=(w-h)*l,k=Math.sqrt(z*z+T*T),H=k*v,P=z*v,C=T*v,I=r(H,P,C)*o*(1-u(H,P,C));k>i||void 0===e[b]||(s===_.AdditiveBlending?e[b].z+=I:s===_.SubtractiveBlending?e[b].z-=I:s===_.MultiplyBlending?e[b].z*=I:s===_.NoBlending?e[b].z=I:s===_.NormalBlending?e[b].z=u(H,P,C)*e[b].z+I:"function"==typeof s&&(e[b].z=s(e[b].z,I,H,P,C)))}};function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var I=function(e){return Object.assign(_,e).Terrain}(n),L=function(){return n.REVISION>="125"};console.warn("@@ __ge125():",L());const O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};P(this,e);var r={xSize:1,ySize:1,maxHeight:.1,minHeight:-.1,xS:63,yS:63},n=Object.assign({},r,t);this.xSize=n.xSize,this.ySize=n.ySize,this.maxHeight=n.maxHeight,this.minHeight=n.minHeight,this.xS=n.xS,this.yS=n.yS}var t,r,a;return t=e,a=[{key:"loadHeightmapImage",value:function(e,t){var r=new Image;r.onload=function(){t(r)},r.src=e}},{key:"getBlendedMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,r=new n.TextureLoader;r.load("./sand1.jpg",(function(a){a.wrapS=a.wrapT=n.RepeatWrapping,r.load("./grass1.jpg",(function(n){r.load("./stone1.jpg",(function(i){r.load("./snow1.jpg",(function(r){var o=I.generateBlendedMaterial([{texture:a},{texture:n,levels:[-80*t,-35*t,20*t,50*t]},{texture:i,levels:[20*t,50*t,60*t,85*t]},{texture:r,glsl:"1.0 - smoothstep(".concat(65*t," + smoothstep(-256.0, 256.0, vPosition.x) * ").concat(10*t,", ").concat(80*t,", vPosition.z)")},{texture:i,glsl:"slope > 0.7853981633974483 ? 0.2 : 1.0 - smoothstep(0.47123889803846897, 0.7853981633974483, slope) + 0.2"}]);e(o)}))}))}))}))}},{key:"buildTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=[new n.MeshLambertMaterial({color:4007959}),new n.MeshLambertMaterial({color:2968606})],r=new n.Mesh(new n.CylinderGeometry(2*e,2*e,12*e,6*e,1*e,!0));r.position.y=6*e;var a=new n.Mesh(new n.CylinderGeometry(0*e,10*e,14*e,8*e));a.position.y=18*e;var i=new n.Mesh(new n.CylinderGeometry(0*e,9*e,13*e,8*e));i.position.y=25*e;var o=new n.Mesh(new n.CylinderGeometry(0*e,8*e,12*e,8*e));o.position.y=32*e;var s=new n.Geometry;r.updateMatrix(),a.updateMatrix(),i.updateMatrix(),o.updateMatrix(),s.merge(r.geometry,r.matrix),s.merge(a.geometry,a.matrix),s.merge(i.geometry,i.matrix),s.merge(o.geometry,o.matrix);for(var u=r.geometry.faces.length,c=0,f=s.faces.length;c<f;c++)s.faces[c].materialIndex=c<u?0:1;var h=new n.Mesh(s,t);return h.scale.x=h.scale.z=5,h.scale.y=1.25,h}},{key:"getSkyDome",value:function(e){(new n.TextureLoader).load("./sky1.jpg",(function(t){t.minFilter=n.LinearFilter;var r=new n.Mesh(new n.SphereGeometry(8192,16,16,0,2*Math.PI,0,.5*Math.PI),new n.MeshBasicMaterial({map:t,side:n.BackSide,fog:!1}));r.position.y=-.99,e(r)}))}},{key:"getWater",value:function(){var e=new n.Mesh(new n.PlaneBufferGeometry(17408,17408,16,16),new n.MeshLambertMaterial({color:27552,transparent:!0,opacity:.6}));return e.position.y=-.99,e.rotation.x=-.5*Math.PI,e}},{key:"getSunLight",value:function(){var e=new n.DirectionalLight(15252912,1.5);return e.position.set(2950,2625,-160),e}},{key:"getSkyLight",value:function(){var e=new n.DirectionalLight(12839679,.75);return e.position.set(-1,-.5,-1),e}}],(r=[{key:"getTerrainScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I.DiamondSquare;return I({easing:I.Linear,frequency:2.5,heightmap:t,material:e,steps:1,useBufferGeometry:!1,xSize:this.xSize,ySize:this.ySize,maxHeight:this.maxHeight,minHeight:this.minHeight,xSegments:this.xS,ySegments:this.yS})}},{key:"getScatterMeshesScene",value:function(t){var r,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.001,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02;return r=L()?new n.Mesh(new n.CylinderGeometry(10*i,10*i,60*i,5),new n.MeshBasicMaterial({color:13421568})):e.buildTree(i),a||L()||(r.geometry=(new n.BufferGeometry).fromGeometry(r.geometry)),{scene:I.ScatterMeshes(t,{mesh:r,w:this.xS,h:this.yS,spread:o,randomness:Math.random}),material:r.material}}}])&&C(t.prototype,r),a&&C(t,a),e}();function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=B(e);if(t){var a=B(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return q(this,r)}}function q(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const G=function(e){var t=document.getElementById("canvas"),r=new n.PerspectiveCamera(75,t.width/t.height,.001,1e4);r.position.set(0,0,.5),r.up=new n.Vector3(0,1,0);var a=new n.WebGLRenderer({canvas:t}),o=new e(r,a.domElement),u=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=t.clientWidth,i=t.clientHeight;(e||t.width!=n||t.height!=i)&&(a.setSize(n,i,!1),r.aspect=n/i,r.updateProjectionMatrix())};u(!0);var f=function(){var e=new n.Scene,i=function(){a.render(e,r)};e.add(new n.AxesHelper(1));var o=new n.Mesh(new n.BoxGeometry(1,1,1),new n.MeshPhongMaterial({color:12640448,side:n.BackSide,wireframe:!0,opacity:1,transparent:!0}));o.name="walls",e.add(o);var s=new b({color:16711680});e.add(s);var u=new O({xSize:1,ySize:1,maxHeight:.1,minHeight:-.1}),f=[];O.getBlendedMaterial((function(t){O.loadHeightmapImage("./heightmapMods.png",(function(r){var n=u.getTerrainScene(t,r),a=n.children[0];a.name="terrain",f.push(a);var o=u.getScatterMeshesScene(a.geometry,!1).scene;n.add(o),f=f.concat(o.children),e.add(n),i()}))})),O.getSkyDome((function(t){e.add(t),i()})),e.add(O.getWater()),e.add(O.getSunLight()),e.add(O.getSkyLight());var h=new n.MeshBasicMaterial({color:5596842,wireframe:!0}),m=c()("#msg"),d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return"(".concat(e.x.toFixed(t),", ").concat(e.y.toFixed(t),", ").concat(e.z.toFixed(t),")")},g=function(e){var t=e.getPoints(),r=t.shift();t.pop();m.empty(),t.length>0&&(m.append("<div>laser source: ".concat(d(r),"</div>")),m.append("<div># reflections: ".concat(t.length,"</div>")),m.append("<div>reflection points: ".concat(t.map((function(e){return d(e)})).join(", "),"</div>")))},v=function(e){if(m.empty(),1===e.length)m.append("<div>points: ".concat(d(e[0])," -> </div>"));else if(2===e.length){var t=N(e,2),r=t[0],n=t[1];m.append("<div>points: ".concat(d(r)," -> ").concat(d(n),"</div>")),m.append("<div>length: ".concat(r.distanceTo(n).toFixed(3),"</div>"))}},y=new b({maxPoints:2});e.add(y);var S,x=[];return{scene:e,render:i,mark:function(n,a){if("Measure"===p.laserMode){var i=s.raycastFromCamera(n,a,t.width,t.height,r,f);if(null!==i){var o=i.point;if(1===x.length){x.push(o);var u=new b({maxPoints:2,color:S});u.updatePoints(x),e.add(u)}else x=[o],S=Math.floor(16777215*Math.random())}p.evRender&&l(),v(x)}},markCancel:function(){v(x=[]),y.visible=!1,p.evRender&&l()},pick:function(e,a){if("None"!==p.laserMode){var i=s.raycastFromCamera(e,a,t.width,t.height,r,f);if(null!==i){var o=i.point,u=new n.Vector3(.003,-.004,.002);if("Raytrace"===p.laserMode)s.setSource(u,r),s.pointWithRaytrace(o,f,65535,16),s.getMeshesHit().forEach((function(e){"terrain"!==e.name&&(e.material=h)}));else"Measure"===p.laserMode&&(s.setSource(u,r),s.point(o,16777215),1===x.length?(y.setSource(x[0]),y.point(o,S),y.visible=!0):y.visible=!1)}else s.clearPoints();p.evRender&&l(),"Raytrace"===p.laserMode&&g(s)}else s.clearPoints()}}}(),h=function(e){f.scene.traverse((function(t){if(!(!t instanceof n.Mesh)&&t.name&&"terrain"===t.name)switch(e){case"Textured":t.material.wireframe=!1,t.material.needsUpdate=!0,t.visible=!0;break;case"Wireframe":t.material.wireframe=!0,t.material.needsUpdate=!0,t.visible=!0;break;case"None":t.visible=!1}})),f.render()},m=new(s());m.showPanel(1),document.body.appendChild(m.dom);var l=function(){m.update(),u(),f.render()},d=!0,g=function e(){d||(requestAnimationFrame(e),l())},v=function(e){e?d=!0:(d=!1,g())},y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(i,e);var t,r,n,a=j(i);function i(){return E(this,i),a.apply(this,arguments)}return t=i,(r=[{key:"initGui",value:function(e,t,r){var n=this;e.add(r,"laserMode",["Raytrace","Measure","None"]).name("Laser Mode").onChange((function(e){t.laserMode=e})),e.add(r,"vis",["Textured","Wireframe","None"]).name("Terrain").onChange((function(e){h(e),t.vis=e})),e.add(r,"evRender").name("Passive Render").onChange((function(e){v(e),t.evRender=e})),e.add(r,"reset").name("Reset").onChange((function(e){n.applyDefaults(),h(r.vis),r.laserMode,v(r.evRender),Object.assign(t,r)})),e.add(r,"sourceCode").name("Source Code").onChange((function(e){window.location.href="https://github.com/w3reality/three-laser-pointer/tree/master/examples/demo-terrains"}))}}])&&D(t.prototype,r),n&&D(t,n),i}(i()),p={vis:"Textured",laserMode:"Raytrace",evRender:!0};new y(p).setDefaults({vis:p.vis,laserMode:p.laserMode,evRender:p.evRender,reset:function(){},sourceCode:function(){}});var S=function(e){var r=t.getBoundingClientRect();return[e.clientX-r.left,e.clientY-r.top]},x=!1;a.domElement.addEventListener("mousedown",(function(e){x=!1}),!1),a.domElement.addEventListener("mousemove",(function(e){x=!0;var t=S(e);f.pick(t[0],t[1])}),!1),a.domElement.addEventListener("mouseup",(function(e){if(x);else if(0===e.button){var t=S(e);f.mark(t[0],t[1])}else 2===e.button&&f.markCancel()}),!1),p.evRender&&(l(),o.addEventListener("change",l))}}},t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}return r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(486)})().default;export default NoPkgName;